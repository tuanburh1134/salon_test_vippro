<!-- templates/booking/list.html -->
<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="vi">
<head th:replace="~{fragments/common :: head}">
    <title>Danh sách đặt lịch</title>
</head>
<body>
<nav th:replace="~{fragments/common :: navigation}"></nav>

<main>
    <div class="page-header">
        <div class="container d-flex align-items-center justify-content-between">
            <div>
                <h1 class="mb-1">
                    <i class="fa-regular fa-calendar-check me-2"></i>Danh sách đặt lịch
                </h1>
                <p class="mb-0">Danh sách đặt lịch tại salon</p>
            </div>
            <div>
                <a class="btn btn-primary" th:href="@{/bookings/new}">
                    <i class="fa-solid fa-plus me-1"></i>Thêm đặt lịch
                </a>
            </div>
        </div>
    </div>

    <div class="container">
        <div class="card">
            <div class="card-body p-0">
                <div class="table-responsive">
                    <table class="table table-hover mb-0 align-middle">
                        <thead class="table-dark">
                        <tr>
                            <th style="width:80px">STT</th>
                            <th style="width:180px">Mã</th>
                            <th style="width:220px">Khách hàng</th>
                            <th style="width:220px">Nhân viên</th>
                            <th>Dịch vụ</th>
                            <th style="width:200px">Thời gian</th>
                            <th style="width:140px" class="text-center">Trạng thái</th>
                            <th style="width:150px" class="text-end">Thao tác</th>
                        </tr>
                        </thead>

                        <!-- Có dữ liệu -->
                        <tbody th:if="${hasBookings}">
                        <tr th:each="b,iter : ${bookings}">
                            <td>
                                <span class="badge bg-secondary" th:text="${iter.index + 1}">1</span>
                            </td>
                            <td>
                                <code th:text="${b.code}">BK-...</code>
                            </td>
                            <td>
                                <i class="fa-regular fa-user text-muted me-1"></i>
                                <strong th:text="${b.customer != null && b.customer.name != null ? b.customer.name : '---'}">---</strong>
                            </td>
                            <td>
                                <i class="fa-solid fa-user-tie text-muted me-1"></i>
                                <span th:text="${employeeNamesById[b.id]} ?: '---'">---</span>
                            </td>
                            <td>
                                <i class="fa-solid fa-spa text-muted me-1"></i>
                                <span th:text="${serviceNamesById[b.id]} ?: '---'">---</span>
                            </td>
                            <td th:text="${b.bookedAt != null ? #temporals.format(b.bookedAt, 'dd/MM/yyyy HH:mm') : ''}">
                                01/01/2025 12:00
                            </td>
                            <td class="text-center">
                                <span class="badge"
                                      th:classappend="${b.status}=='CHO_XU_LY'   ? ' bg-warning text-dark' :
                                                      (${b.status}=='XAC_NHAN'    ? ' bg-info' :
                                                      (${b.status}=='HOAN_THANH'  ? ' bg-success' : ' bg-secondary'))"
                                      th:text="${b.status}">CHO_XU_LY</span>
                            </td>
                            <td class="text-end">
                                <a class="btn btn-sm btn-outline-warning" th:href="@{|/bookings/${b.id}/edit|}">
                                    <i class="fa-regular fa-pen-to-square"></i>
                                </a>
                                <form class="d-inline" method="post"
                                      th:action="@{|/bookings/${b.id}/delete|}"
                                      onsubmit="return confirm('Xóa đặt lịch này?');">
                                    <button class="btn btn-sm btn-outline-danger" type="submit">
                                        <i class="fa-regular fa-trash-can"></i>
                                    </button>
                                </form>
                            </td>
                        </tr>
                        </tbody>

                        <!-- Không có dữ liệu -->
                        <tbody th:if="${!hasBookings}">
                        <tr>
                            <td colspan="8" class="text-center py-4 text-muted">
                                <i class="fa-regular fa-inbox fa-2x mb-2"></i><br>Không có dữ liệu
                            </td>
                        </tr>
                        </tbody>

                    </table>
                </div>
            </div>
        </div>
    </div>
</main>

<footer th:replace="~{fragments/common :: footer}"></footer>
<div th:replace="~{fragments/common :: scripts}"></div>
</body>
</html>
